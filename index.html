<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Energy Booster AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.263.1"
            }
        }
    </script>
    <script type="module" src="https://esm.sh/run" defer></script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #fca5a5; border-radius: 20px; }
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 200ms, transform 200ms; }
    </style>
</head>
<body class="bg-orange-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Send, Zap, Settings, X, Save } from 'lucide-react';

        const EnergyApp = () => {
            const [messages, setMessages] = useState([]);
            const [inputValue, setInputValue] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [lang, setLang] = useState('en'); 
            const [showSettings, setShowSettings] = useState(false);
            
            // Settings State
            const [config, setConfig] = useState({
                provider: 'google',
                apiKey: '',
                baseUrl: 'https://api.deepseek.com',
                modelName: 'deepseek-chat'
            });

            const messagesEndRef = useRef(null);

            useEffect(() => {
                const savedConfig = localStorage.getItem('energy_app_config');
                if (savedConfig) {
                    setConfig(JSON.parse(savedConfig));
                }
            }, []);

            const saveConfig = (newConfig) => {
                setConfig(newConfig);
                localStorage.setItem('energy_app_config', JSON.stringify(newConfig));
            };

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, isTyping]);

            useEffect(() => {
                const greeting = lang === 'en' 
                    ? "Hi! Energy Bot here. Click 'Settings' ‚öôÔ∏è to set up your Key!"
                    : "‰Ω†Â•ΩÔºÅËÉΩÈáèÂä©ÊâãÂú®Ê≠§„ÄÇÁÇπÂáªÂè≥‰∏äËßí‚ÄúËÆæÁΩÆ‚Äù ‚öôÔ∏è Â°´ÂÖ• Key ÂºÄÂßã‰ΩøÁî®ÔºÅ";
                
                setMessages([{ id: 1, text: greeting, sender: 'bot' }]);
            }, [lang]);

            const callAI = async (userText) => {
                if (!config.apiKey) {
                    return lang === 'en' 
                        ? "‚ö†Ô∏è Please click 'Settings' (top right) and enter your API Key." 
                        : "‚ö†Ô∏è ËØ∑ÁÇπÂáªÂè≥‰∏äËßíÁöÑ‚ÄúËÆæÁΩÆ‚ÄùÊåâÈíÆÔºåËæìÂÖ•‰Ω†ÁöÑ API Key„ÄÇ";
                }

                const systemPromptText = `You are a high-energy, supportive AI personal cheerleader. 
                Your goal is to hype the user up, validate their feelings, and provide energy.
                If the user speaks Chinese, reply in Chinese. If English, reply in English.
                Keep responses short, punchy, and under 3 sentences. Use enthusiastic emojis like üî•, üí™, üöÄ.`;

                try {
                    let responseText = "";

                    if (config.provider === 'google') {
                        const response = await fetch(
                            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${config.apiKey}`,
                            {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    contents: [{ parts: [{ text: userText }] }],
                                    systemInstruction: { parts: [{ text: systemPromptText }] },
                                }),
                            }
                        );
                        if (!response.ok) throw new Error("Google API Error");
                        const data = await response.json();
                        responseText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    } else {
                        // Custom (DeepSeek/OpenAI) Logic
                        const apiUrl = config.baseUrl.endsWith('/chat/completions') 
                            ? config.baseUrl 
                            : `${config.baseUrl.replace(/\/$/, '')}/chat/completions`;

                        const response = await fetch(apiUrl, {
                            method: "POST",
                            headers: { 
                                "Content-Type": "application/json",
                                "Authorization": `Bearer ${config.apiKey}`
                            },
                            body: JSON.stringify({
                                model: config.modelName || "deepseek-chat",
                                messages: [
                                    { role: "system", content: systemPromptText },
                                    { role: "user", content: userText }
                                ],
                                stream: false
                            })
                        });
                        if (!response.ok) throw new Error("Custom API Error");
                        const data = await response.json();
                        responseText = data.choices?.[0]?.message?.content;
                    }

                    return responseText || (lang === 'en' ? "Let's Go!" : "Âä†Ê≤πÔºÅ");
                } catch (error) {
                    console.error("AI Request Failed:", error);
                    return lang === 'en' 
                        ? `Connection failed. Check API Key or Network.` 
                        : `ËøûÊé•Â§±Ë¥•„ÄÇËØ∑Ê£ÄÊü• Key ÊàñÁΩëÁªú (ÂõΩÂÜÖËØ∑Áî® DeepSeek)„ÄÇ`;
                }
            };

            const handleSend = async () => {
                if (!inputValue.trim()) return;
                const userMsg = { id: Date.now(), text: inputValue, sender: 'user' };
                setMessages(prev => [...prev, userMsg]);
                setInputValue('');
                setIsTyping(true);
                const botResponseText = await callAI(userMsg.text);
                const botMsg = { id: Date.now() + 1, text: botResponseText, sender: 'bot' };
                setMessages(prev => [...prev, botMsg]);
                setIsTyping(false);
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter') handleSend();
            };

            const toggleLang = () => setLang(prev => prev === 'en' ? 'cn' : 'en');

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-100 via-yellow-50 to-orange-100 flex items-center justify-center p-4 font-sans text-slate-800">
                    <div className="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col h-[85vh] border-4 border-yellow-400 relative">
                        
                        {/* Header */}
                        <div className="bg-gradient-to-r from-orange-400 to-yellow-400 p-3 flex items-center justify-between shadow-md z-10 shrink-0">
                            <div className="flex items-center gap-1 text-white font-bold text-lg">
                                <Zap className="fill-current text-yellow-100 w-5 h-5" />
                                <span>{lang === 'en' ? 'Energy' : 'ËÉΩÈáèÁ´ô'}</span>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={toggleLang} className="text-white bg-white/10 hover:bg-white/20 px-2 py-1 rounded-lg transition-colors text-xs font-bold border border-white/30">
                                    {lang === 'en' ? 'CN' : 'EN'}
                                </button>
                                {/* üëá ËÆæÁΩÆÊåâÈíÆÂú®ËøôÈáå üëá */}
                                <button 
                                    onClick={() => setShowSettings(true)} 
                                    className="flex items-center gap-1 text-white bg-white/20 hover:bg-white/30 px-2 py-1 rounded-lg transition-colors border border-white/40"
                                >
                                    <Settings size={16} />
                                    <span className="text-xs font-bold">{lang === 'en' ? 'Set' : 'ËÆæÁΩÆ'}</span>
                                </button>
                            </div>
                        </div>

                        {/* Chat Area */}
                        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-white/50 relative">
                            {messages.map((msg) => (
                                <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[85%] p-3 rounded-2xl shadow-sm text-sm leading-relaxed ${
                                        msg.sender === 'user' ? 'bg-orange-500 text-white rounded-tr-none' : 'bg-white border border-yellow-200 text-slate-700 rounded-tl-none'
                                    }`}>
                                        {msg.text}
                                    </div>
                                </div>
                            ))}
                            {isTyping && (
                                <div className="flex justify-start">
                                    <div className="bg-white border border-yellow-200 p-3 rounded-2xl rounded-tl-none shadow-sm flex items-center gap-1">
                                        <span className="w-2 h-2 bg-orange-400 rounded-full animate-bounce"></span>
                                        <span className="w-2 h-2 bg-orange-400 rounded-full animate-bounce delay-75"></span>
                                        <span className="w-2 h-2 bg-orange-400 rounded-full animate-bounce delay-150"></span>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>

                        {/* Input Area */}
                        <div className="p-4 bg-white border-t border-yellow-100 z-10 shrink-0">
                            <div className="flex gap-2">
                                <input type="text" value={inputValue} onChange={(e) => setInputValue(e.target.value)} onKeyDown={handleKeyDown} placeholder={lang === 'en' ? "Type here..." : "ËæìÂÖ•..."} className="flex-1 bg-slate-50 border border-slate-200 text-slate-700 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400 transition-all text-sm" />
                                <button onClick={handleSend} disabled={!inputValue.trim()} className="bg-gradient-to-r from-orange-500 to-yellow-500 text-white p-2 rounded-full shadow-lg hover:shadow-orange-300/50 transition-all disabled:opacity-50">
                                    <Send size={18} className="ml-0.5" />
                                </button>
                            </div>
                        </div>

                        {/* Settings Modal */}
                        {showSettings && (
                            <div className="absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <div className="bg-white w-full max-w-sm rounded-2xl shadow-2xl p-5 animate-[scale_0.2s_ease-out]">
                                    <div className="flex justify-between items-center mb-4 border-b pb-2">
                                        <h3 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                                            <Settings size={18} /> API ËÆæÁΩÆ
                                        </h3>
                                        <button onClick={() => setShowSettings(false)} className="text-slate-400 hover:text-slate-600">
                                            <X size={20} />
                                        </button>
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase mb-1">ÈÄâÊã©Ê®°Âûã</label>
                                            <div className="flex bg-slate-100 p-1 rounded-lg">
                                                <button 
                                                    onClick={() => saveConfig({...config, provider: 'google'})}
                                                    className={`flex-1 py-2 text-sm font-medium rounded-md transition-all ${config.provider === 'google' ? 'bg-white shadow-sm text-orange-600' : 'text-slate-500'}`}
                                                >
                                                    Google
                                                </button>
                                                <button 
                                                    onClick={() => saveConfig({...config, provider: 'custom'})}
                                                    className={`flex-1 py-2 text-sm font-medium rounded-md transition-all ${config.provider === 'custom' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}`}
                                                >
                                                    DeepSeek/ÂõΩÂÜÖ
                                                </button>
                                            </div>
                                        </div>

                                        {config.provider === 'custom' && (
                                            <>
                                                <div>
                                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Base URL (Âú∞ÂùÄ)</label>
                                                    <input 
                                                        type="text" 
                                                        value={config.baseUrl}
                                                        onChange={(e) => saveConfig({...config, baseUrl: e.target.value})}
                                                        placeholder="https://api.deepseek.com"
                                                        className="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-400 outline-none"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Model Name (Ê®°ÂûãÂêç)</label>
                                                    <input 
                                                        type="text" 
                                                        value={config.modelName}
                                                        onChange={(e) => saveConfig({...config, modelName: e.target.value})}
                                                        placeholder="deepseek-chat"
                                                        className="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-400 outline-none"
                                                    />
                                                </div>
                                            </>
                                        )}

                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase mb-1">API Key (ÂØÜÈí•)</label>
                                            <input 
                                                type="password" 
                                                value={config.apiKey}
                                                onChange={(e) => saveConfig({...config, apiKey: e.target.value})}
                                                placeholder="Á≤òË¥¥‰Ω†ÁöÑ Key Âà∞ËøôÈáå..."
                                                className="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-400 outline-none"
                                            />
                                        </div>

                                        <button 
                                            onClick={() => setShowSettings(false)}
                                            className="w-full bg-slate-800 text-white font-bold py-3 rounded-xl hover:bg-slate-700 transition flex items-center justify-center gap-2 mt-4"
                                        >
                                            <Save size={18} /> ‰øùÂ≠òÂπ∂ÂÖ≥Èó≠
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<EnergyApp />);
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>
